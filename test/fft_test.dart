// Copyright 2022 The Deep Defender Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import 'dart:typed_data';
import 'package:test/test.dart';
import 'package:deep_defender/fft.dart';

void testFft(List<double> inp, List<double> exp) {
  final buf = Float64List.fromList(inp);
  Fft(buf.length ~/ 2).inPlaceFft(buf);
  for (int i = 0; i < buf.length; ++i) {
    expect(buf[i], closeTo(exp[i], 1e-4));
  }
}

main() {
  test('FFT', () {
    testFft(
      [-5.983411, -9.995780],
      [-5.983411, -9.995780],
    );
    testFft(
      [-1.999309, 0.027633, 9.232593, 8.266936],
      [7.233284, 8.294569, -11.231902, -8.239303],
    );
    testFft(
      [
        3.079088, 9.309553, 2.093103, -6.324357, -7.321577, 0.226908, //
        -9.133344, -3.113532
      ],
      [
        -11.282730, 0.098573, 7.189840, -2.143801, 2.797752, 18.974349, //
        13.611490, 20.309092
      ],
    );
    testFft(
      [
        -6.862447, 6.723845, 9.545484, -6.816709, 7.447154, -7.607547, //
        3.408545, -1.864040, 2.134166, -6.642073, -2.804472, 0.444487, //
        -0.059789, 6.034094, 3.285285, 0.399274
      ],
      [
        16.093927, -9.328669, -20.727519, -6.494957, -17.023102, 1.608045, //
        -10.735396, 15.587002, -10.775757, 6.345307, -24.548989, 18.212906, //
        -7.208191, 1.702406, 20.025453, 26.158721
      ],
    );
    testFft(
      [
        -3.261618, -5.143070, -1.572700, 0.042771, 8.465448, -0.349342, //
        2.917433, -9.889073, -5.250644, 7.442629, -2.640354, 1.697084, //
        1.655275, -7.470799, -8.202704, 8.103977, -7.828070, -1.954915, //
        -1.350698, 9.775716, -3.400918, -6.047788, -4.888571, 7.342137, //
        -1.819744, 6.728871, 7.758956, -0.557073, 5.002272, 0.763288, //
        -3.794544, 0.287481
      ],
      [
        -18.211183, 10.771893, 10.508705, -15.432078, -18.083007, //
        -7.208224, -19.954388, -7.923399, -24.768179, 4.014564, //
        15.494154, -11.585895, 6.848401, -38.136701, -9.001629, //
        37.094922, 5.335184, -22.834146, 17.980719, 23.572937, //
        10.665168, -32.144713, 2.558896, -37.066495, -34.996130, //
        36.341745, -22.862739, 4.416017, -15.507760, -7.588302, //
        41.807900, -18.581249
      ],
    );
    testFft(
      [
        -3.391571, -7.902416, -1.390485, 6.871220, 7.536507, -0.328396, //
        5.497954, 7.965259, -8.847183, 7.015379, -4.184189, -1.568464, //
        5.116758, -2.755102, -0.412103, 1.784873, 9.369135, 0.117998, //
        -5.786887, -5.127207, 7.995162, -8.018761, 0.988397, 0.512031, //
        6.553980, -8.690355, -6.929440, -3.901339, -6.316244, -3.281157, //
        -2.852461, -3.364299, 6.071828, 4.422859, -6.489713, 0.734514, //
        -6.648751, -5.583950, -0.534135, -0.215573, -3.068274, -5.615998, //
        7.231800, 3.291881, -6.747623, -0.442502, 6.585249, 0.445056, //
        -4.229032, 8.644195, 9.155604, 1.712140, 5.116151, 6.758020, //
        -2.567692, -9.884223, -3.846345, -1.722999, 0.388842, 9.334927, //
        -8.146008, 6.888473, -9.446704, -5.615990
      ],
      [
        -14.227473, -7.519908, -27.337452, 25.162590, -24.190517, //
        -6.396426, 24.712431, -43.092312, 3.528651, -27.523820, //
        -17.716931, -60.069921, 2.188777, -48.636415, -60.276210, //
        -64.671442, 20.427122, 8.295011, 21.919732, 4.792510, //
        59.137262, 20.106953, 23.824375, 8.944271, 33.584554, //
        44.107472, -17.195163, -64.387884, 25.634268, -50.377172, //
        11.310699, 68.919009, 7.264452, -13.469519, -29.143545, //
        -57.286259, -8.738723, 13.344757, 1.157499, -18.147041, //
        15.362117, -4.067333, 7.754432, -20.041008, -11.502873, //
        -8.998117, -37.534435, 23.928390, -19.013952, -2.230936, //
        -67.138631, -34.000360, 11.203530, -17.529915, 8.338939, //
        -11.118271, 15.637405, 44.670123, -15.059203, -1.557206, //
        -73.410501, 0.552338, 20.969078, 45.420540
      ],
    );
    testFft(
      [
        -3.199652, -1.931124, 2.412020, 0.261429, 0.952767, 5.234112, //
        -3.912968, -0.221811, -7.454430, -7.581843, -8.449493, 6.949177, //
        -4.977557, 2.539883, -1.341899, 7.705698, -0.932121, 9.315682, //
        -0.076715, -1.140070, 3.216375, 6.207554, -5.942381, 5.309097, //
        2.587980, -8.527793, 6.291952, 5.362612, 1.426680, -8.004290, //
        0.972759, -0.258873, -2.292556, -1.401945, 0.627900, -0.564503, //
        -0.552112, -9.511575, 3.079007, 0.726573, 8.066817, 8.829321, //
        -7.573853, -6.390339, -9.136053, 4.969708, 2.096282, 7.083892, //
        -8.405408, 1.882304, -0.592881, -4.787128, -3.217422, -8.819128, //
        -7.247433, 9.213961, -3.362282, 0.839960, -4.282355, -0.463072, //
        0.563961, 7.587694, -4.214188, 9.283792, -5.950894, -7.562928, //
        6.927606, 7.977417, 0.393728, 3.800268, -0.885495, 4.815511, //
        -1.564637, 9.446554, 8.874163, 0.139324, 6.409066, 6.242965, //
        -0.739251, -9.167261, 8.232297, 6.131262, 5.912529, -2.734355, //
        8.471889, 5.139983, 0.619895, 4.519040, -4.572666, 8.659102, //
        8.818773, 4.553704, -9.213956, 1.970339, 2.723040, -0.526629, //
        3.462517, 7.503518, 1.799766, -3.345081, 2.570343, 5.824950, //
        3.710622, 6.595810, 6.990314, -3.990063, 0.589177, -5.268920, //
        -1.243897, -5.406695, 4.772866, 2.388694, 9.060841, 2.205591, //
        -5.174275, -4.671757, -9.626301, 4.574731, 3.916328, 6.702848, //
        -7.232869, -7.736807, -1.197949, 5.704716, -1.747715, -4.394057, //
        -4.173135, -9.229218
      ],
      [
        -13.936539, 80.561513, -46.976492, 21.341786, -16.384509, //
        -29.985970, 20.435136, 39.922517, -1.196848, -46.390149, //
        -2.840207, -78.398018, 31.340226, 22.801412, 24.847972, //
        -20.436272, 32.069037, -40.679382, 52.575206, 77.584821, //
        8.822038, -27.882580, -14.086260, -43.494845, -12.624137, //
        -22.095864, 26.430472, -0.694566, 38.382184, -45.730006, //
        20.090938, -13.367991, -34.214516, -23.347966, 46.730273, //
        24.284408, -71.374324, -62.559876, 15.402133, 65.500837, //
        48.864250, -48.833243, -7.589658, -25.605098, -22.493151, //
        -45.155749, -7.922570, 15.699673, -3.776523, 70.249431, //
        -53.930905, 98.943131, 52.507052, -47.742732, 55.024272, //
        44.746618, -66.112156, -23.728606, -18.185302, 50.668436, //
        -32.125717, -11.300706, 57.292764, -10.739230, -30.617365, //
        -12.487045, -46.574632, -41.198150, 27.712903, -32.675846, //
        -24.312036, 53.601325, 15.961183, -61.426870, 3.125095, //
        -29.682319, -7.231395, 65.146450, 78.814622, 6.844487, //
        -5.144745, 32.829767, 59.681936, 116.278575, -6.831281, //
        -11.637881, -31.118156, 18.536153, -39.210676, 25.354704, //
        -16.602568, 39.884050, -86.404615, -105.453979, -7.573330, //
        -51.828693, 52.501424, 19.596660, -2.056276, -41.541980, //
        -16.786408, 51.712005, -42.259284, -2.351199, -73.495331, //
        -9.530609, -36.008802, 42.365579, 15.583284, -6.560030, //
        -36.045543, 45.203744, 2.919424, 2.415902, 4.464378, //
        5.890817, 30.642866, -17.150059, 83.390603, -46.644354, //
        0.324168, 3.232099, -60.710070, -77.931446, -110.487268, //
        54.645547, -5.473973, -103.165076
      ],
    );
    testFft(
      [
        3.339208, -6.990024, 4.205429, 6.536006, 2.644615, 0.215951, //
        -7.775392, 4.467677, 0.030443, -8.017812, 9.085703, 6.465884, //
        4.623916, 7.280867, 9.565785, 9.103772, 1.759909, 9.391679, //
        9.717872, 0.211993, -0.339445, -8.858024, -6.781152, -3.066160, //
        -9.637546, 3.383432, -5.171311, 1.116985, -0.258442, 5.994793, //
        4.889069, 7.801222, 2.342791, 0.363359, -3.415077, -0.704497, //
        -3.032158, 9.752772, 6.756356, 4.859587, -3.753131, -2.802366, //
        6.349238, 0.245910, -3.986789, -5.494520, -4.031109, -4.217901, //
        9.878132, -6.898554, -1.777042, 7.646552, -4.999291, 2.852488, //
        -5.347669, 0.499859, -0.122778, 1.028493, 0.148401, -1.927238, //
        -8.861742, 6.965875, -9.231383, -6.624425, -5.865183, 8.664768, //
        -6.818185, 9.319540, -4.843982, -7.339363, 4.604694, 9.723655, //
        0.340210, -9.305923, -1.438607, -0.231417, 1.675467, 1.210095, //
        -4.206135, 7.804063, 9.959286, 3.110660, -6.395076, 2.375061, //
        2.877729, 8.935813, 6.583084, 2.621834, 5.887653, 3.266026, //
        4.426640, -5.407771, -2.689064, -2.014202, -7.901139, 9.454978, //
        7.183683, -4.194202, -1.278182, -8.224561, 5.762929, 8.430595, //
        0.126973, -2.858941, 1.441860, -2.819900, 7.002505, 3.421182, //
        -2.786745, 7.156984, 6.595813, 0.985345, -4.360373, -8.935637, //
        -0.214579, -9.939980, 6.686096, -1.094001, -5.052786, -9.295827, //
        -8.430927, 6.272351, 5.563900, 4.886128, 2.275187, 6.070246, //
        9.858140, -8.028377, 5.904393, 9.304467, 2.215077, 4.196496, //
        -8.008710, 7.077562, -4.889921, -6.240256, -1.198170, 9.343255, //
        6.388992, 5.694433, 6.784530, 7.994350, 7.732001, -6.582312, //
        1.688088, -2.779394, -3.325607, 9.103464, -0.529776, 8.002667, //
        -3.489868, -2.440335, 2.309434, 9.230899, -9.876979, 4.270517, //
        4.989183, 3.430275, -3.252602, 0.178230, -6.883887, 9.017518, //
        -3.225594, -1.066840, -9.149255, 3.225938, -1.295065, -7.546203, //
        -3.654092, -9.205787, 7.220400, 2.373269, 1.894714, 2.619937, //
        -6.527889, 1.745791, -5.591928, 2.759545, 3.530461, -7.850486, //
        -4.289458, -1.880534, 3.136075, 5.553008, -8.500843, 1.239970, //
        4.189135, 7.107079, -7.214292, 8.539114, 9.427797, 4.404025, //
        -7.180112, -3.942106, -3.663215, -0.723617, -3.600706, 2.823622, //
        -1.046515, -7.318781, 0.694716, 6.035280, -8.337702, 7.935658, //
        3.358185, -7.003637, 1.550045, -1.832573, -0.368610, -7.180496, //
        5.635702, 3.068602, -7.762743, -0.106213, -5.636590, -2.871964, //
        -8.582498, 5.014574, 7.417445, -9.650120, -0.098928, 5.509029, //
        -0.756478, 3.343022, -0.645353, -1.806944, -6.415027, -6.534655, //
        -6.505103, -9.071484, -2.801989, 7.950576, 8.926063, -6.407022, //
        7.716761, -7.846642, -4.199977, 4.629102, -9.895599, 2.172858, //
        -3.407968, 4.623950, 2.414860, 9.593138, -1.836466, 2.452799, //
        3.093744, 7.546425, -2.348603, -9.941352, -6.970857, 1.912912, //
        -8.366881, -3.501291, -5.182156, -9.330452
      ],
      [
        -64.909920, 124.964717, -14.346178, -80.133852, 145.089222, //
        35.094146, -23.231576, -54.212699, 59.746525, -24.615927, //
        -86.949565, -10.214218, 47.067300, -105.272412, 11.290161, //
        -72.701392, -112.285200, -62.349328, -10.097465, -100.266355, //
        84.140729, -24.960608, -5.847271, -150.877985, -4.726946, //
        23.183002, -11.528118, -27.419332, 0.434881, 55.264115, //
        55.120555, 38.107811, -15.231317, 79.213651, 23.140242, //
        -33.920214, 79.564803, -19.487822, -103.545765, 6.056902, //
        100.115264, -82.643262, 138.413872, -23.091263, 120.919559, //
        33.715540, 24.188922, -37.213660, 59.288643, 70.435454, //
        -84.606058, -29.789789, 118.962913, -50.341554, 98.784189, //
        -87.734017, 20.801992, 26.982360, -40.692375, -106.712117, //
        -14.051502, -2.485107, -9.963989, -13.876734, 56.352834, //
        -120.072238, -27.125030, -37.206477, 42.786807, -77.624626, //
        -52.823189, 39.559429, 167.939482, 3.908528, 58.219917, //
        8.763236, -39.128181, -43.570731, -34.255257, -7.865810, //
        -41.433608, 15.590419, 17.186464, 18.944267, -5.862116, //
        24.587054, -114.240009, -23.143210, 95.158548, 9.979179, //
        -25.207908, -62.325490, -24.468596, 15.386654, 20.515758, //
        78.109403, 66.744016, 23.402767, 95.712545, -60.633118, //
        -25.701534, 65.827586, 21.428330, 152.020101, -53.116840, //
        92.560906, -29.527955, -63.259767, 58.968754, -81.638951, //
        83.606443, 54.993155, 61.931972, 62.232644, -24.978864, //
        -15.924765, -24.074884, -19.620644, 44.756570, -53.722386, //
        -46.265577, 23.257823, 32.419785, -149.683385, -9.759845, //
        4.539488, 10.714609, -63.472198, -72.357154, 26.295910, //
        -47.045456, -190.591152, 29.463521, 73.348914, 44.038612, //
        -3.334872, -33.614922, -88.778715, 78.277920, 7.620578, //
        18.924963, 25.278246, -38.403318, -90.258234, -69.208353, //
        39.488697, 55.235611, -13.635866, 171.638886, 15.070366, //
        -14.573950, -107.680346, -53.067351, -5.853164, 80.199781, //
        156.249530, -95.657737, -32.263012, -44.549560, 79.576462, //
        35.999033, -14.696620, -86.796031, -11.642731, 8.269513, //
        -10.952274, -55.373840, 10.897463, -94.123417, 39.667187, //
        38.627707, 27.707377, 56.559542, 37.852201, -53.355131, //
        -37.431486, 54.727317, -13.526530, 19.916020, -60.116349, //
        -47.457648, 88.438102, -142.361694, -73.198847, -104.970910, //
        -32.463947, 67.319708, -37.458534, -57.808123, -71.545669, //
        88.021157, 89.472053, 5.529701, -27.897555, 50.101666, //
        -23.389454, -61.552454, 105.686579, 22.099502, 15.989407, //
        -90.954040, 31.749806, 22.255294, 7.930687, 64.247547, //
        -39.307477, -17.173382, -125.854499, 6.784506, -56.445486, //
        31.284332, -45.789877, 13.322005, 1.202289, -47.507833, //
        86.188009, 48.369512, 44.123369, -8.962349, 271.784874, //
        82.999198, 31.056370, -84.878933, 34.212754, 49.889419, //
        -55.141906, 55.879027, 105.833490, 41.912452, -76.515028, //
        -91.405415, -36.135711, -14.438318, -74.756011, -61.760593, //
        -105.130555, -107.961441, -27.850514, -49.793555, -59.553821, //
        -50.693238, 75.174797, -1.900657, 32.646261, 32.232494, //
        8.986823, 36.318517, -82.405733, -89.635857, 72.216850, //
        18.668770, 87.352929, 9.223646, -14.961036, -63.105531, //
        16.144690
      ],
    );
  });
}
